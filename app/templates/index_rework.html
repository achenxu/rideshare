{% extends "layout.html" %}

{% block title %}Ride{% endblock %}

{% block head %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB15X6ti6tDQUQKjwPCI2zi3XFfxZW3MGM&sensor=false" type="text/javascript"></script>
{% endblock %}

{% block main %}
<div data-notify="container"></div>

{% if circle %}
<div class="panel panel-primary padding">
    <div class="panel-body">
        You are currently viewing the events and rides for <a href='/circle/{{circle.key().id()}}'>{{circle.name}}</a> circle. Any rides or events created will only be visible to this circle. <a href='/map'>Exit circle view.</a>
    </div>
</div>
{% endif %}

<div class="panel panel-default padding">
    <div class="panel-body">
        To get started, <b>click on a marker to get details</b> or
        <div class="btn-group">
            <button class='btn btn-default' data-next='create_trip'>Create a Trip</button>
            <button class='btn btn-default' data-next='create_ride'>Ask for a Ride</button>
        </div>
        <div class="btn-group pull-right">
            <button class='btn btn-primary' data-reset>
                <i class="fa fa-tencent-weibo"></i>
                Start over
            </button>
            <button class='btn btn-primary' data-help='toggle'>
                <i class="fa fa-navicon"></i>
                Help
            </button>
        </div>
        <hr>
        <div class="key">
            <i class='fa fa-key'></i>
            Key
        </div>
        <div class="key">
            <img src="/static/carRed.png" />
            Destination
        </div>
        <div class="key">
            <img src="/static/carGreen.png" />
            Starting point
        </div>
    </div>
</div>

{% include 'help_map.html' %}

<div class="row">

    <div class="col-md-8 map_con" id='col_map'>
        <div id="map_canvas"></div>
    </div>

    <div class="col-md-4 map_con" id='col_dialog' data-route='select_location'>

    </div>

    <div class="col-md-4" data-route='location_selection'>
        
    </div>

    <div class="col-md-4" data-route='select_type'>
        <p>Do you need a ride or can you drive?</p>
        <button class="btn btn-primary" data-next='location_dest' data-option='passenger'>
            Need a Ride
        </button>
        <button class="btn btn-primary" data-next='location_dest' data-option='driver'>
            Driving
        </button>
    </div>

    <div class="col-md-4" data-route='passenger_details'>
        <form data-send="passenger">
            <div class="form-group">
                <label>Date</label>
                <input class="form-control date-select" type="text" placeholder="Date" name='date'>
            </div>
            <div class="form-group">
                <label>Time</label>
                <input class="form-control" type="text" placeholder="Time" name='time'>
            </div>
            <div class="form-group">
                <label>Additional Details</label>
                <input class="form-control" type="text" placeholder="Details" name='details'>
            </div>
            <button class="btn btn-primary" type='submit'>
                Ask for Ride
            </button>
        </form>
    </div>

    <div class="col-md-4" data-route='location_dest'>
        <form>
            <p class="lead">
                Select the Destination
            </p>
            <div class="form-group">
                <label>Destination:
                    <span data-ride="loc_dest"></span>
                </label>
            </div>
            <hr>
            <form data-search>
                <div class="form-group">
                    <label>Enter an address, city, or state:</label>
                    <input type="text" class="form-control" name="address">
                </div>
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
            <hr>
            <button class="btn btn-primary hidden" data-next="details" type='button' data-ride="loc_btn">
                Next
            </button>
        </form>
    </div>

    <div class="col-md-4" data-route='driver_details'>
        <form data-send="ride">
            <p class="lead">Give us additional details</p>
            <div class="form-group">
                <label>Max Passengers</label>
                <select class="form-control" name='max_passengers'>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                </select>
            </div>
            <div class="form-group">
                <label>Date</label>
                <input class="form-control date-select" type="text" placeholder="Date" name='date'>
            </div>
            <div class="form-group">
                <label>Time</label>
                <input class="form-control" type="text" placeholder="Time" name='time'>
            </div>
            <div class="form-group">
                <label>Additional Details</label>
                <input class="form-control" type="text" placeholder="Details" name='details'>
            </div>
            <button class="btn btn-primary"  type='submit'>
                Create Ride
            </button>
        </form>
    </div>

    <div class="col-md-4" data-route='safety'>
        <p>This is a safety agreement that you have agreed to follow. This is important.</p>
        <button class='btn btn-primary' data-next='true'>Agree & Continue</button>
    </div>

    <div class="col-md-4" data-route="join_ride">
        
    </div>
</div>
{% endblock %}

{% block scripts %}

{% raw %}

<script data-template='select_location' type='text/x-handlebars-template'>
    <div class="locsec">
        <h1>Select the {{type}} location</h1>
        <p>Use one of the following options:</p>
        <ul>
            <li>
                <h2>Point & Click</h2>
                Select a location by clicking on the map
            </li>
            <li>
                <h2>Geolocation</h2>
                <button class='geo_location btn btn-primary'>Use your current location.</button>
            </li>
            <li>
                <h2>Search</h2>
                <form data-search>
                    <div class="form-group">
                        <label>Enter an address, city, or state:</label>
                        <input type="text" class="form-control" name="address">
                    </div>
                    <button type="submit" class="btn btn-primary">Search</button>
                </form>
            </li>
        </ul>
        <hr>
        Selected location: <span data-location='text'>None</span>
        <button class="btn btn-primary hidden" data-next="true" type='button' data-location="btn">
            Next
        </button>
    </div>
</script>

<script data-template='popup' type="text/x-handlebars-template">
    <div class="entry">
        This is the: <strong>{{primary}}</strong> point.
    </div>
    <div class="entry">
        <strong>{{primary}} Location:</strong> {{primary_add}}
    </div>
    <div class="entry">
        <strong>{{secondary}} Location:</strong> {{secondary_add}}
    </div>
    <a class='btn btn-primary' href='/ride/{{id}}'>Join this ride</a>
</script>

<script data-notify="template" type='text/x-handlebars-template'>
    <div class="alert alert-{{type}} alert-dismissable">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <strong>{{strong}}</strong> {{message}}
    </div>
</script>

{% endraw %}

<script src="/static/augment.js" type="text/javascript"></script>
<script src="/static/maps2.js" type="text/javascript"></script>
<script src="/static/flow2.js" type="text/javascript"></script>
<script type="text/javascript" src="/static/jquery_ui/jquery-ui-1.10.4.custom.js"></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js' type="text/javascript"></script>

<script type="text/javascript">
var flow = new Flow('select_location', paths);
flow.set_handler(map);

$('.date-select').datepicker();

/* Toggle Help */
var help = {};
help.btn = document.querySelector('[data-help="toggle"]');
help.container = document.querySelector('[data-help="container"]');

help.btn.addEventListener('click', function (e) {
    var target = e.target;

    help.container.classList.toggle('hidden');
});
/* End */

</script>

{% endblock %}